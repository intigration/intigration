


<!DOCTYPE html>
<html lang="en-us">
  <head>
    <script>
        var host = "10up.github.io";
        if ( window.location.host === host && window.location.protocol !== "https:" ) {
            window.location.protocol = "https:";
        }
    </script>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.ico" type="image/x-icon">

    <title>
      10up Engineering Best Practices
    </title>

    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic|PT+Mono&subset=latin,cyrillic">

    <script type='text/javascript' src='//use.typekit.net/dtp2teh.js?ver=4.0'></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <!-- Google Analytics to go here -->
  </head>
  <body class="page-javascript">
    <header id="page-header" role="banner">
	<div class="page-header-content">
		<a href="/Engineering-Best-Practices" class="logo-link">10up</a>
		<nav class="page-nav top-nav" role="navigation" aria-label="Main navigation.">
			<ul class="header-nav nav-dropdowns js-mobile-expandable">
				
				
				
  
    
  

  
    
  

  

  

  
    
  

  
    
      
      <li>
      
      	<a href="/">Home</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/#audience">Audience</a></li>
            
          
            
              <li><a href="/#goal">Goal</a></li>
            
          
            
              <li><a href="/#philosophy">Philosophy</a></li>
            
          
            
              <li><a href="/#contributing">Contributing</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/css/">CSS</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/css/#philosophy">Philosophy</a></li>
            
          
            
              <li><a href="/css/#accessibility">Accessibility</a></li>
            
          
            
              <li><a href="/css/#performance">Performance</a></li>
            
          
            
              <li><a href="/css/#responsive-design">Responsive Design</a></li>
            
          
            
              <li><a href="/css/#syntax-formatting">Syntax and Formatting</a></li>
            
          
            
              <li><a href="/css/#documentation">Documentation</a></li>
            
          
            
              <li><a href="/css/#frameworks">Frameworks</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li class="current-menu-item">
      
      	<a href="/javascript/">JS</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/javascript/#code-style">Code Style & Documentation</a></li>
            
          
            
              <li><a href="/javascript/#design-patterns">Design Patterns</a></li>
            
          
            
              <li><a href="/javascript/#performance">Performance</a></li>
            
          
            
              <li><a href="/javascript/#client-side-data">Client-Side Data</a></li>
            
          
            
              <li><a href="/javascript/#unit-and-integration-testing">Unit and Integration Testing</a></li>
            
          
            
              <li><a href="/javascript/#libraries">Libraries and Frameworks</a></li>
            
          
            
              <li><a href="/react">React</a></li>
            
          
            
              <li><a href="/nodejs">Node.js</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/markup/">Markup</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/markup/#philosophy">Philosophy</a></li>
            
          
            
              <li><a href="/markup/#accessibility">Accessibility</a></li>
            
          
            
              <li><a href="/markup/#structure">Structure</a></li>
            
          
            
              <li><a href="/markup/#media">Media</a></li>
            
          
            
              <li><a href="/markup/#svg">SVG</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/tools/">Tools</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/tools/#local-development">Local Development Environments</a></li>
            
          
            
              <li><a href="/tools/#scaffolding">Scaffolding</a></li>
            
          
            
              <li><a href="/tools/#task-runners">Task Runners</a></li>
            
          
            
              <li><a href="/tools/#package-managers">Package/Dependency Managers</a></li>
            
          
            
              <li><a href="/tools/#version-control">Version Control</a></li>
            
          
            
              <li><a href="/tools/#command-line">Command Line Tools</a></li>
            
          
            
              <li><a href="/tools/#a11y-testing">Accessibility Testing</a></li>
            
          
            
              <li><a href="/tools/#vrt">Visual Regression Testing</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/php/">PHP</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/php/#performance">Performance</a></li>
            
          
            
              <li><a href="/php/#design-patterns">Design Patterns</a></li>
            
          
            
              <li><a href="/php/#security">Security</a></li>
            
          
            
              <li><a href="/php/#code-style">Code Style & Documentation</a></li>
            
          
            
              <li><a href="/php/#unit-testing">Unit and Integration Testing</a></li>
            
          
            
              <li><a href="/php/#libraries">Libraries and Frameworks</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/structure/">Design</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/structure/#file-organization">File Organization</a></li>
            
          
            
              <li><a href="/structure/#dependencies">Dependencies</a></li>
            
          
            
              <li><a href="/structure/#integrations">Third-Party Integrations</a></li>
            
          
            
              <li><a href="/structure/#modular-code">Modular Code</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/migrations/">Migrations</a>
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/version-control/">VCS</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/version-control/#structure-package-management">Structure</a></li>
            
          
            
              <li><a href="/version-control/#workflows">Workflows</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/site-security/">Security</a>
      	
      </li>
    
  

  
    
      
      <li>
      
      	<a href="/systems/">Systems</a>
      	
      	
      	<ul class="subnav">
      	  
            
              <li><a href="/systems/#nginx">Nginx</a></li>
            
          
            
              <li><a href="/systems/#php-fpm">PHP-FPM</a></li>
            
          
            
              <li><a href="/systems/#mysql">MySQL</a></li>
            
          
            
              <li><a href="/systems/#memcached-and-redis">Memcached and Redis</a></li>
            
          
            
              <li><a href="/systems/#load-balancing">Load Balancing</a></li>
            
          
      	</ul>
      	
      	
      </li>
    
  




			</ul>
		</nav>

		<a href="https://github.com/10up/" class="main-nav-supplemental-icon">
			<span class="screen-reader-text">View on Github</span>
		</a>
		<a class="toggle-menu-icon js-mobile-expandable-toggle">
			<span class="screen-reader-text">Toggle Main Navigation</span>
		</a>

	</div>
</header>

<header id="top" class="template-header header-javascript">
	<div class="grid-inner">
		<h1>
			
				JavaScript
			
		</h1>
	</div>
</header>


    <div class="docs-section">
		
		<h2 id="code-style" class="anchor-heading">Code Style, Tooling &amp; Documentation <a class="subhead-anchor" href="#code-style"><span>#code-style</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-link" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><path d="M13.757 19.868a1.62 1.62 0 0 1-1.149-.476c-2.973-2.973-2.973-7.81 0-10.783l6-6C20.048 1.169 21.963.376 24 .376s3.951.793 5.392 2.233c2.973 2.973 2.973 7.81 0 10.783l-2.743 2.743a1.624 1.624 0 1 1-2.298-2.298l2.743-2.743a4.38 4.38 0 0 0 0-6.187c-.826-.826-1.925-1.281-3.094-1.281s-2.267.455-3.094 1.281l-6 6a4.38 4.38 0 0 0 0 6.187 1.624 1.624 0 0 1-1.149 2.774z" /><path d="M8 31.625a7.575 7.575 0 0 1-5.392-2.233c-2.973-2.973-2.973-7.81 0-10.783l2.743-2.743a1.624 1.624 0 1 1 2.298 2.298l-2.743 2.743a4.38 4.38 0 0 0 0 6.187c.826.826 1.925 1.281 3.094 1.281s2.267-.455 3.094-1.281l6-6a4.38 4.38 0 0 0 0-6.187 1.624 1.624 0 1 1 2.298-2.298c2.973 2.973 2.973 7.81 0 10.783l-6 6A7.575 7.575 0 0 1 8 31.625z" /></svg>
</a>
 <a class="back-to-top" href="#top">back to top</a></h2>

<p>10up maintains a <a href="https://github.com/10up/eslint-config">eslint shareable config</a> that is used across all 10up projects. It exposes several different configs and engineers should opt-in to the config that best fits the project. We also maintain a <a href="https://github.com/10up/babel-preset-default/">babel-preset</a> that works well for most of our projects.</p>

<p>As far as JavaScript documentation goes, we conform to the <a href="https://make.wordpress.org/core/handbook/best-practices/inline-documentation-standards/javascript/">WordPress JavaScript documentation standards</a> and those standards are enforced by 10up’s eslint config.</p>

<h2 id="design-patterns" class="anchor-heading">Design Patterns <a class="subhead-anchor" href="#design-patterns"><span>#design-patterns</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-link" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><path d="M13.757 19.868a1.62 1.62 0 0 1-1.149-.476c-2.973-2.973-2.973-7.81 0-10.783l6-6C20.048 1.169 21.963.376 24 .376s3.951.793 5.392 2.233c2.973 2.973 2.973 7.81 0 10.783l-2.743 2.743a1.624 1.624 0 1 1-2.298-2.298l2.743-2.743a4.38 4.38 0 0 0 0-6.187c-.826-.826-1.925-1.281-3.094-1.281s-2.267.455-3.094 1.281l-6 6a4.38 4.38 0 0 0 0 6.187 1.624 1.624 0 0 1-1.149 2.774z" /><path d="M8 31.625a7.575 7.575 0 0 1-5.392-2.233c-2.973-2.973-2.973-7.81 0-10.783l2.743-2.743a1.624 1.624 0 1 1 2.298 2.298l-2.743 2.743a4.38 4.38 0 0 0 0 6.187c.826.826 1.925 1.281 3.094 1.281s2.267-.455 3.094-1.281l6-6a4.38 4.38 0 0 0 0-6.187 1.624 1.624 0 1 1 2.298-2.298c2.973 2.973 2.973 7.81 0 10.783l-6 6A7.575 7.575 0 0 1 8 31.625z" /></svg>
</a>
 <a class="back-to-top" href="#top">back to top</a></h2>

<p>Standardizing the way we structure our JavaScript allows us to collaborate more effectively with one another. Using intelligent design patterns improves maintainability, code readability, and even helps to prevent bugs.</p>

<h3 id="writing-modern-javascript">Writing Modern JavaScript</h3>

<p>It’s important we use language features that are intended to be used. This means not using deprecated functions, methods, or properties. Whether we are using plain JavaScript or a library, we should not use deprecated features. Using deprecated features can have negative effects on performance, security, maintainability, and compatibility.</p>

<p>On all new projects you should be using up to date JavaScript methodologies combined with a build process tool like <a href="https://babeljs.io/">Babel</a> to ensure browser compatibility. This allows us to utilize modern techniques while being certain our code will not break in older systems. The <a href="https://github.com/10up/theme-scaffold">theme scaffolding</a> and <a href="https://github.com/10up/plugin-scaffold">plugin scaffolding</a> have this functionality built in.</p>

<p>Some older projects that have not yet been upgraded may not have the capability to use the most modern techniques, but it is still important to have processes in place that allow us to grow the technology stack as a project matures. In these cases, you should still follow best practice recommendations even if the newest patterns are not yet available to you.</p>

<h4 id="using-classes">Using Classes</h4>
<p>Before ES6, classes in JavaScript were created by building a constructor function
and adding properties by extending the prototype object. This created a fairly
complex way to extend classes and deal with prototypal inheritance. Modern techniques
allow us to create and extend classes directly and write cleaner code:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">BasicExample</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">super</span><span class="p">();</span> <span class="c1">// if you're extending</span>
	<span class="p">}</span>

	<span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello world.</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Classes in modern JavaScript offer a nicer syntax to access the standard prototypal
inheritance we’ve already had for a while, but can also help guide the structure
of componentized code. When deciding whether or not to use a Class, think of the
code you’re writing in the greater context of the application.</p>

<p>Classes will not always be the answer for creating modular code in your application,
but you should consider them when you need to create discrete components or when
those components need to inherit behaviors from other components, while still
functioning as a single unit. For example, a utility function that searches a
string for text may not be a good utilization of Classes, but an accordion menu
with children components would.</p>

<h4 id="using-arrow-functions">Using Arrow Functions</h4>
<p>Arrow functions are a great way to slim down easily executable code blocks. When
using this style of function be sure not to over engineer a simple action just
to make it smaller. For example, this is a good use of a simple multiline function being
compressed into a single line:</p>

<p>Multi-line:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Single line:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
</code></pre></div></div>

<p>This is a very simple function, so compressing it down into a single line won’t
cause any readability issues. However, the more complicated this function gets,
the less likely it should be on a single line.</p>

<p>Even though single argument arrow functions don’t require parenthesis around the
argument itself, it is best to include the parenthesis for improved readability and
scalability of the function.</p>

<p>Something important to remember is that arrow functions are not always the answer.
Their release addressed a very specific problem many engineers were facing with
preserving the context of <code class="language-plaintext highlighter-rouge">this</code>. In a traditional function <code class="language-plaintext highlighter-rouge">this</code> is bound to
different values depending on the context it is called. With arrow functions, it
is bound to the code that contains the arrow function. Because arrow functions
also have syntax benefits, as a general rule, use arrow functions unless you
need a more traditional treatment of <code class="language-plaintext highlighter-rouge">this</code> (like in an event listener).</p>

<h4 id="concatenating-strings-and-templating">Concatenating Strings and Templating</h4>
<p>When dealing with strings in JavaScript, it is very common to need some form of
concatenation along the way. Before ES6 we were concatenating string with the <code class="language-plaintext highlighter-rouge">+</code>
operator:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* eslint-disable */</span>
<span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">last</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">world</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">I said, "</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">first</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">last</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">" to the crowd.</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>Modern techniques give us something called, “template literals”, which let us concatenate
strings in a much more straightforward manner utilizing the back tick and some
basic templating:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">first</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">last</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">world</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="s2">`I said, "</span><span class="p">${</span><span class="nx">first</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">last</span><span class="p">}</span><span class="s2">," to the crowd.`</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="destructuring-arrays-and-objects">Destructuring Arrays and Objects</h4>
<p>Destructuring is a JavaScript technique that allows you to easily assign values
and properties from arrays and objects into specific variables. This direct mapping
affords an easy way to access data from objects and arrays in a more convenient
syntax.</p>

<p>The old way:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</code></pre></div></div>

<p>The new way:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span> <span class="c1">// 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span> <span class="c1">// 2</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span> <span class="c1">// 3</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span> <span class="c1">// 4</span>
</code></pre></div></div>

<p>Use destructuring whenever possible to slim down your code and improve overall readability.</p>

<h4 id="componentizing-your-code">Componentizing Your Code</h4>

<p>Keeping different bits of functionality in your code reasonably separated is important
to building and maintaining a scalable system over time. In the past we’ve had to
accomplish this with our build systems leaning on concatenation as an abstraction
layer to the project. Modern JavaScript techniques allow us to utilize <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import"><code class="language-plaintext highlighter-rouge">import</code></a> statements
to break apart and reassemble your code into consumable chunks.</p>

<p>When you’re building your project, be sure to lean on imports to wire your application
together. As of right now, we do still need a build system to process the code so it can be
consumed by a browser, but using this modern technique will make sure our code is well
structured as the project ages. You can also use <code class="language-plaintext highlighter-rouge">import</code> statements to load parts of an external
library you may need for any given component. The code below will give you an example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Only loading in the map method from lodash, because that's all we need!</span>
<span class="k">import</span> <span class="nx">map</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">lodash/map</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>This also allows you to build one component and import it into another.</p>

<p>It’s also worth noting that named exports can be imported by wrapping the exported function within curly braces:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">example</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">example/lib</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>This is only possible if the exported component is a named export like so:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="mi">66</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="modules">Modules</h3>

<p>When creating your own modules be sure to think about how it should be used by others. Luckily ES6 modules makes this a simple task.</p>

<p>There are many ways you can export a module, but typically exposing specific functions and/or data structures through an ES6 module is the preferred way.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// datastructure.js</span>
<span class="c1">// private variable to the module</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// private function to the module</span>
<span class="kd">const</span> <span class="nx">process</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="c1">// complex logic</span>
	<span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// the two functions below are public</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">getData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">process</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">field</span><span class="p">]);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">addData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">field</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">data</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>In the module above only two functions are being exposed, everything else is private to the module, therefore this module can be used as following.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">addData</span><span class="p">,</span> <span class="nx">getData</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./datastructure</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">addData</span><span class="p">(</span><span class="dl">'</span><span class="s1">key</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">myvalue</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">getData</span><span class="p">(</span><span class="dl">'</span><span class="s1">key</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>
<p>Avoid using classes unless there’s a good reason to. Consider the following example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Module</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./mymodule</span><span class="dl">'</span><span class="p">;</span>
<span class="cm">/* Module is a ES6 class */</span>
<span class="k">new</span> <span class="nx">Module</span><span class="p">(</span><span class="dl">'</span><span class="s1">.element-selector</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="cm">/* options */</span>
	<span class="na">onEvent1</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
	<span class="na">onEvent2</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
<span class="p">});</span>
</code></pre></div></div>

<p>A good indicator that you don’t need classes is when you don’t need the instance of that class. For this reason our eslint config has the <a href="https://eslint.org/docs/rules/no-new">no-new</a> rule enabled. The code sample below provides a better alternative.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Option 1: still using classes but with a better design</span>
<span class="k">import</span> <span class="nx">Module</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./mymodule</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">module1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Module</span><span class="p">(</span><span class="dl">'</span><span class="s1">.element-selector</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="cm">/* options */</span>
<span class="p">});</span>
<span class="nx">module1</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">onEvent1</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{});</span>
<span class="nx">module1</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">onEvent2</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{});</span>
<span class="nx">module1</span><span class="p">.</span><span class="nx">doSomething</span><span class="p">();</span>
<span class="nx">module1</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
</code></pre></div></div>

<p>The example above changes the design of the module API a bit and assumes multiple and separate instance of the module are desired. However, sometimes that might not even be necessary. If all you need is to abstract some complex logic and accept a couple of parameter, exposing a factory/init function is all you need.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Option 2: not using classes</span>
<span class="k">import</span> <span class="nx">module</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./mymodule</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">module</span><span class="p">(</span><span class="dl">'</span><span class="s1">.element-selector</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="cm">/* options */</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="dont-pollute-the-window-object">Don’t Pollute the Window Object</h3>

<p>Adding methods or properties to the <code class="language-plaintext highlighter-rouge">window</code> object or the global namespace should be done carefully. <code class="language-plaintext highlighter-rouge">window</code> object pollution can result in collisions with other scripts. If you need to expose data to the rest of your application, you should first consider using some sort of state management. Sometimes however, exposing methods or properties to the <code class="language-plaintext highlighter-rouge">window</code> global is necessary and when doing so wrap your code in closures and expose methods and properties to <code class="language-plaintext highlighter-rouge">window</code> with caution.</p>

<p>When a script is not wrapped in a closure, the current context or <code class="language-plaintext highlighter-rouge">this</code> is actually <code class="language-plaintext highlighter-rouge">window</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span> <span class="o">===</span> <span class="nb">window</span><span class="p">);</span> <span class="c1">// true</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// Do stuff</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">result</span> <span class="o">===</span> <span class="nx">result</span><span class="p">);</span> <span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">i</span><span class="p">);</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>When we put our code inside a closure, our variables are private to that closure unless we expose them:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// Do stuff</span>
	<span class="p">}</span>

	<span class="nb">window</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">})();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">result</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// true</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">i</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// false</span>
</code></pre></div></div>

<p>Notice how <code class="language-plaintext highlighter-rouge">i</code> was not exposed to the <code class="language-plaintext highlighter-rouge">window</code> object.</p>

<h3 id="secure-your-code">Secure Your Code</h3>

<p>In JavaScript, we often have to insert new elements with dynamic attributes and content into the DOM. A common way to do this is to use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML"><code class="language-plaintext highlighter-rouge">innerHTML</code></a> method like so:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">someElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">someElement</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">someUrl</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://someurl.com/</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">someContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Some content</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">someElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">`&lt;div class="container"&gt;&lt;a href="</span><span class="p">${</span><span class="nx">someUrl</span><span class="p">}</span><span class="s2">"&gt;</span><span class="p">${</span><span class="nx">someContent</span><span class="p">}</span><span class="s2">&lt;/a&gt;&lt;/div&gt;`</span><span class="p">;</span>
</code></pre></div></div>
<p>However, passing HTML strings to <code class="language-plaintext highlighter-rouge">innerHTML</code> and methods like it can expose your code to <a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting">cross-site scripting</a>, also known as XSS—the most common security vulnerability in JavaScript. Because these methods evaluate strings passed to them as HTML, they can execute potentially harmful code. For instance, if <code class="language-plaintext highlighter-rouge">someContent</code> in the above example is <code class="language-plaintext highlighter-rouge">&lt;img src="fakeImage" onerror="alert( 'hacked!' )" /&gt;</code>, the JavaScript in the <code class="language-plaintext highlighter-rouge">onerror</code> attribute will be executed.</p>

<p>There are several measures you can take to circumvent this XSS vulnerability:</p>

<h4 id="use-textcontent-instead-of-innerhtml">Use <code class="language-plaintext highlighter-rouge">textContent</code> instead of <code class="language-plaintext highlighter-rouge">innerHTML</code></h4>

<p>When setting the human-readable content of a single element, using <code class="language-plaintext highlighter-rouge">textContent</code> is safer than using <code class="language-plaintext highlighter-rouge">innerHTML</code> because it does not parse strings as HTML—meaning any malicious code passed to it will not be executed. Refer to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent">MDN’s documentation on <code class="language-plaintext highlighter-rouge">textContent</code></a> for more info.</p>

<h4 id="use-the-dom-api-to-create-and-add-elements">Use the <code class="language-plaintext highlighter-rouge">DOM</code> API to create and add elements</h4>

<p>When you need to create multiple DOM elements, use the <code class="language-plaintext highlighter-rouge">document.createElement</code> method to create new elements and the <code class="language-plaintext highlighter-rouge">Element</code> API to set attributes and append them to the document. Creating your own elements and attributes will ensure that only those you explicitly define will make their way into the DOM.</p>

<p>Note that appending new elements to the DOM is a relatively expensive operation, so in general you’ll want to build out the structure of new elements <em>before</em> adding them to the DOM, preferably within a single container element, then append them to the document all at once.</p>

<p>Refer to MDN’s documentation on <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement"><code class="language-plaintext highlighter-rouge">document.createElement</code></a> and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element"><code class="language-plaintext highlighter-rouge">Element</code> API</a> for more info.</p>

<h4 id="sanitize-html-strings-before-adding-to-the-dom">Sanitize HTML strings before adding to the DOM</h4>

<p>In general, using the <code class="language-plaintext highlighter-rouge">Element</code> API is the preferred best practice to safely create and add DOM elements. However, it tends to result in much more verbose code compared to HTML-parsing methods like <code class="language-plaintext highlighter-rouge">innerHTML</code>. This can become painful if you need to dynamically create a large number of new elements. In these cases, the convenience of methods like <code class="language-plaintext highlighter-rouge">innerHTML</code> can be extremely tempting.</p>

<p>If you need to generate a large amount of HTML dynamically, consider using a <code class="language-plaintext highlighter-rouge">DOMParser</code> to parse and sanitize HTML strings before adding the HTML to the DOM with a method like <code class="language-plaintext highlighter-rouge">innerHTML</code>. Parsing HTML strings with a <code class="language-plaintext highlighter-rouge">DOMParser</code> will not automatically make the code any safer, but it will allow you to access the elements from the string and strip potentially unsafe tags and attributes before they have a chance to get executed. Refer to <a href="https://developer.mozilla.org/en-US/docs/Web/API/DOMParser">MDN’s documentation on <code class="language-plaintext highlighter-rouge">DOMParser</code></a> for more info.</p>

<p>Alternatively, you may consider adding a client-side sanitization library to your project so you can strip potentially malicious code from your HTML before you add it to the DOM. Passing your HTML strings through a sanitizer can help prevent XSS attacks when using methods like <code class="language-plaintext highlighter-rouge">innerHTML</code>. However, no library is perfect, so be aware that you are relying on the security of the sanitizer you choose. Also, remember to consider the effect on <a href="#performance">performance</a> when deciding whether to add any large library to your project.</p>

<h2 id="performance" class="anchor-heading">Performance <a class="subhead-anchor" href="#performance"><span>#performance</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-link" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><path d="M13.757 19.868a1.62 1.62 0 0 1-1.149-.476c-2.973-2.973-2.973-7.81 0-10.783l6-6C20.048 1.169 21.963.376 24 .376s3.951.793 5.392 2.233c2.973 2.973 2.973 7.81 0 10.783l-2.743 2.743a1.624 1.624 0 1 1-2.298-2.298l2.743-2.743a4.38 4.38 0 0 0 0-6.187c-.826-.826-1.925-1.281-3.094-1.281s-2.267.455-3.094 1.281l-6 6a4.38 4.38 0 0 0 0 6.187 1.624 1.624 0 0 1-1.149 2.774z" /><path d="M8 31.625a7.575 7.575 0 0 1-5.392-2.233c-2.973-2.973-2.973-7.81 0-10.783l2.743-2.743a1.624 1.624 0 1 1 2.298 2.298l-2.743 2.743a4.38 4.38 0 0 0 0 6.187c.826.826 1.925 1.281 3.094 1.281s2.267-.455 3.094-1.281l6-6a4.38 4.38 0 0 0 0-6.187 1.624 1.624 0 1 1 2.298-2.298c2.973 2.973 2.973 7.81 0 10.783l-6 6A7.575 7.575 0 0 1 8 31.625z" /></svg>
</a>
</h2>

<p>Writing performant code is absolutely critical. Poorly written JavaScript can significantly slow down and even crash the browser. On mobile devices, it can prematurely drain batteries and contribute to data overages. Performance at the browser level is a major part of user experience which is part of the 10up mission statement.</p>

<p>We have a published <a href="https://www.npmjs.com/package/@10up/eslint-config">.eslint</a> configuration that’s used on 10up projects. This linting is included in our <a href="https://github.com/10up/theme-scaffold">theme scaffolding</a> and <a href="https://github.com/10up/plugin-scaffold">plugin scaffolding</a> and should help you adhere to our coding standards.</p>

<h3 id="only-load-libraries-you-need">Only Load Libraries You Need</h3>

<p>JavaScript libraries should only be loaded on the page when needed. React + React DOM are around 650 KB together. This isn’t a huge deal on a fast connection but can add up quickly in a constrained bandwidth situation when we start adding a bunch of libraries. Loading a large number of libraries also increases the chance of conflicts.</p>

<p>Not only should you only load the libraries you need, but using import statements, you should only load the <em>parts</em> of the libraries you need. For example, if you’re using <a href="https://lodash.com/">Lodash</a>, it can be very large to load the entire system, especially if you’re not using all of it. You should always utilize import statements to target relevant parts of an external library to make sure you’re loading only what you need. The code block below will illustrate this point:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">map</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">lodash/map</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">tail</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">lodash/tail</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">times</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">lodash/times</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">uniq</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">lodash/uniq</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>This code block imports four methods from Lodash instead of the entire library. <a href="https://www.blazemeter.com/blog/the-correct-way-to-import-lodash-libraries-a-benchmark">Read more about the proper way to load Lodash</a>. These imports can also be reduced to a single line, but for Lodash specifically, it’s more performant to separate them.</p>

<h3 id="cache-dom-selections">Cache DOM Selections</h3>

<p>It’s a common JavaScript mistake to reselect something unnecessarily. For example, every time a menu button is clicked, we do not need to reselect the menu. Rather, we select the menu once and cache its selector. This applies whether you are using a library or not. For example:</p>

<p>Uncached:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hideButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.hide-button</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">hideButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">menu</span><span class="dl">'</span><span class="p">);</span>
	<span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Cached:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">menu</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">hideButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.hide-button</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">hideButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Notice how, in cached versions, we are pulling the menu selection out of the event listener so it only happens once. The cached version is, not surprisingly, the <a href="https://jsperf.com/dom-selection-caching">fastest way to handle this situation</a>.</p>

<h3 id="event-delegation">Event Delegation</h3>

<p>Event delegation is the act of adding one event listener to a parent node to listen for events bubbling up from its children. This is much more performant than adding one event listener for each child element. Here is an example:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">menu</span><span class="dl">'</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="p">{</span> <span class="nx">currentTarget</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>
	<span class="kd">let</span> <span class="p">{</span> <span class="nx">target</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">currentTarget</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">LI</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// Do stuff with target!</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">while</span> <span class="p">(</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
				<span class="c1">// Do stuff with a parent.</span>
				<span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>You may be wondering why we don’t just add one listener to the <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> for all our events. Well, we want the event to <em>bubble up the DOM as little as possible</em> for <a href="https://jsperf.com/event-delegation-distance">performance reasons</a>. This would also be pretty messy code to write.</p>

<h3 id="debounce-throttle-and-requestanimationframe">Debounce, Throttle, and requestAnimationFrame</h3>

<p>Browser events such as scrolling, resizing, and cursor movements happen as fast as possible and can cause performance issues. By debouncing, throttling, or using requestAnimationFrame on our functions, we can increase performance by controlling the rate at which an event listener calls them.</p>

<h4 id="debouncing">Debouncing</h4>
<p>Debouncing a function will prevent it from being called again until a defined amount of time has passed, i.e., execute this function if 200ms has passed since it was last called. A common use case would be when resizing a browser window; we can apply classes or move elements after the resize has happened.</p>

<h4 id="throttling">Throttling</h4>

<p>Throttling a function will cause it to only be called a maximum number of times over a defined period of time, i.e., only execute this function once every 50ms. A common use case would be when scrolling a browser window; we may want an element to show up as we scroll down the page, but killing performance by checking the scroll position constantly isn’t necessary. Debouncing wouldn’t work in this example because we don’t want to wait for the user to stop scrolling.</p>

<h4 id="requestanimationframe">requestAnimationFrame</h4>

<p>requestAnimationFrame is similar to throttling, but it’s a browser native API and tries to always throttle to 60fps. Its very name helps us know when it’s best to use: while animating things. This would be the case when our JavaScript function is updating element positions, sizes, or anything else that’s “painting” to the screen.</p>

<p>Note that some of our recommended utility libraries already provide these functions, such as Underscore’s <a href="https://underscorejs.org/#debounce">debounce</a> and <a href="https://underscorejs.org/#throttle">throttle</a> and Lodash’s <a href="https://lodash.com/docs/4.17.11#debounce">debounce</a> and <a href="https://lodash.com/docs/4.17.11#throttle">throttle</a>.</p>

<p>For more information and examples of debouncing, throttling, and requestAnimationFrame, see <a href="https://css-tricks.com/debouncing-throttling-explained-examples/">Debouncing and Throttling Explained Through Examples</a>, <a href="https://css-tricks.com/the-difference-between-throttling-and-debouncing/">The Difference Between Throttling and Debouncing </a>, and <a href="https://davidwalsh.name/javascript-debounce-function">JavaScript Debounce Function</a>.</p>

<h2 id="client-side-data" class="anchor-heading">Client-side Data <a class="subhead-anchor" href="#client-side-data"><span>#client-side-data</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-link" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><path d="M13.757 19.868a1.62 1.62 0 0 1-1.149-.476c-2.973-2.973-2.973-7.81 0-10.783l6-6C20.048 1.169 21.963.376 24 .376s3.951.793 5.392 2.233c2.973 2.973 2.973 7.81 0 10.783l-2.743 2.743a1.624 1.624 0 1 1-2.298-2.298l2.743-2.743a4.38 4.38 0 0 0 0-6.187c-.826-.826-1.925-1.281-3.094-1.281s-2.267.455-3.094 1.281l-6 6a4.38 4.38 0 0 0 0 6.187 1.624 1.624 0 0 1-1.149 2.774z" /><path d="M8 31.625a7.575 7.575 0 0 1-5.392-2.233c-2.973-2.973-2.973-7.81 0-10.783l2.743-2.743a1.624 1.624 0 1 1 2.298 2.298l-2.743 2.743a4.38 4.38 0 0 0 0 6.187c.826.826 1.925 1.281 3.094 1.281s2.267-.455 3.094-1.281l6-6a4.38 4.38 0 0 0 0-6.187 1.624 1.624 0 1 1 2.298-2.298c2.973 2.973 2.973 7.81 0 10.783l-6 6A7.575 7.575 0 0 1 8 31.625z" /></svg>
</a>
 <a class="back-to-top" href="#top">back to top</a></h2>

<p>When dealing with client-side data requests (Ajax calls), there are a lot of different methods to consider. This portion of the document will walk you through various situations and talk about the different technologies and patterns you may encounter along the way.</p>

<h3 id="using-fetch-and-promises-for-modern-environments">Using Fetch and Promises for Modern Environments</h3>
<p>The Fetch API is a modern replacement for the XMLHttpRequest. It is <a href="https://caniuse.com/#search=fetch">generally well supported</a>, having features present in all evergreen browsers (browsers that auto-update). Fetch is recommended to be used in all modern environments when making Ajax calls or dealing with client-side data requests. Visit the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">MDN Fetch documentation</a> for a basic example of how to use this API.</p>

<p>To properly use fetch, support for Promises also needs to be present (Promises and Fetch have the same <a href="https://caniuse.com/#search=promise">browser support</a>). The support requirement for both is an important distinction when your project needs to support non-evergreen browsers (IE 11 and under), because both APIs will need to be polyfilled to get Fetch working.</p>

<p>To polyfill with NPM, we recommend adding the following packages to your dependencies: <a href="https://www.npmjs.com/package/promise-polyfill">promise-polyfill</a> and <a href="https://www.npmjs.com/package/whatwg-fetch">whatwg-fetch</a>. They are both applicable at different points in the build process. Promises are polyfilled at the file-level with an import and fetch is polyfilled at the build level in your task runner. Please see the <a href="https://www.npmjs.com/package/whatwg-fetch">official whatwg-fetch documentation</a> for detailed installation instructions.</p>

<p>If you are unable to process the polyfills in a modern workflow, the files can also be downloaded and enqueued separately (<a href="https://cdnjs.com/libraries/fetch">fetch</a>, <a href="https://cdn.jsdelivr.net/npm/promise-polyfill@8/">promise</a>), but if possible, they should be implemented at the build level.</p>

<h3 id="using-a-normal-ajax-call-for-older-environments">Using A Normal Ajax Call for Older Environments</h3>
<p>For various reasons on a project, you may not be able to use a modern technique for dealing with client-side data requests. If you find yourself in that situation, it usually isn’t necessary to load an entire library like jQuery for a single feature. If you find yourself in this situation try writing a vanilla ajax call instead. Basic ajax calls do not require any pollyfills or fallbacks, with the exception of providing support on very old browsers like, Internet Explorer 6. You can reference the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#Browser_compatibility">XMLHttpRequest Browser Compatibility table</a> on MDN for specific feature support.</p>

<p>Please see the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">MDN XMLHttpRequest documentation</a> for an example of a basic Ajax call.</p>

<h3 id="when-to-use-a-client-side-data-request-library">When to Use a Client-side Data Request Library</h3>
<p>Sometimes a project may require a more robust solution for managing your requests, especially if you will be making many requests to various endpoints. While Fetch can do most (and someday all) of the things we need, there may be a few areas where it could fall short in your project. A few main items where Fetch may fall short:</p>

<ul>
  <li>Cancelable requests</li>
  <li>Timeout requests</li>
  <li>Request progress</li>
</ul>

<p>It should be noted that these are in <a href="https://github.com/github/fetch#aborting-requests">active development</a> and timeout requests can also be handled by using a <a href="https://davidwalsh.name/fetch-timeout">wrapper function</a>.</p>

<p>Certain libraries have these built in already and are still promised-based, but can also come with a few other advantages that Fetch doesn’t have like: <a href="https://github.com/axios/axios">transformers</a>, <a href="https://github.com/axios/axios">interceptors</a>, and built-in <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">XSRF protection</a>. If you find yourself needing these features that are outside the scope of native JavaScript you may want to evaluate the benefit of using a library.</p>

<p>If you plan on making many requests over the lifetime of the application and you don’t need the features listed above, you should consider making a <a href="https://medium.com/@shahata/why-i-wont-be-using-fetch-api-in-my-apps-6900e6c6fe78">helper function or module</a> that will handle all of your application’s Fetch calls so you can easily include things like: expected error handling, a common URL base, any cookies you may need, any mode changes like CORS, etc.. Overall, you should be able to accomplish what you need to with Fetch in the majority of cases.</p>

<p>Certain codebases may already have such libraries in place. Many legacy projects use <a href="http://api.jquery.com/jquery.ajax/">jQuery.ajax()</a> to make their requests. If possible, attempt to phase out jQuery for a vanilla solution where appropriate. In many cases, replacing with Fetch or XMLHttpRequest will be possible.</p>

<h3 id="concatenating-requests">Concatenating Requests</h3>
<p>When constructing a page that contains a lot of client-side data requests you will want to consider concatenating your requests into a single Ajax call. This will help you avoid piling up requests or sending them through callbacks and nested promises when parts of the data depend on other parts.</p>

<h4 id="graphql">GraphQL</h4>
<p><a href="https://graphql.org/">GraphQL</a> is an open source data query and manipulation language. It provides an alternative to REST because it allows for a consistent way to make declarative queries. We first define the data structure(s) we need, then request the data, and return only the data that was requested. This creates an environment of smaller, more targeted calls to an API. It also allows us to concatenate multiple calls into single data requests, reducing the overhead and time to load.</p>

<p>An essential part of a GraphQL API is an API schema. GraphQL requires a human-readable schema which describes the types which are available, and how they relate to one another. While writing a schema is reasonably straightforward, utilizing the standardized nature of WordPress’s database could save time. It may well be possible to reuse a schema from other projects, such as generated by a plugin like, <a href="https://github.com/wp-graphql/wp-graphql">WPGraphQL</a>.</p>

<h4 id="wpgraphql">WPGraphQL</h4>
<p>If you are choosing to use GraphQL on a WordPress project, it is recommended to use the WPGraphQL plugin. This plugin will return WordPress data in JSON format through a GraphQL endpoint - in many cases you won’t need to write the schema yourself. This will give you all the benefits of concatenating your data requests as well as easy access to your data as it is output by WordPress. You can retrieve your data by passing a query directly into a simple fetch request:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/graphql</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
	<span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span> <span class="p">},</span>
	<span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">query</span><span class="p">:</span> <span class="dl">'</span><span class="s1">[your query string goes here]</span><span class="dl">'</span> <span class="p">}),</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</code></pre></div></div>

<p>The above code snippet will help you get started in making requests to the GraphQL service.</p>

<h2 id="unit-and-integration-testing" class="anchor-heading">Unit and Integration Testing <a class="subhead-anchor" href="#unit-and-integration-testing"><span>#unit-and-integration-testing</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-link" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><path d="M13.757 19.868a1.62 1.62 0 0 1-1.149-.476c-2.973-2.973-2.973-7.81 0-10.783l6-6C20.048 1.169 21.963.376 24 .376s3.951.793 5.392 2.233c2.973 2.973 2.973 7.81 0 10.783l-2.743 2.743a1.624 1.624 0 1 1-2.298-2.298l2.743-2.743a4.38 4.38 0 0 0 0-6.187c-.826-.826-1.925-1.281-3.094-1.281s-2.267.455-3.094 1.281l-6 6a4.38 4.38 0 0 0 0 6.187 1.624 1.624 0 0 1-1.149 2.774z" /><path d="M8 31.625a7.575 7.575 0 0 1-5.392-2.233c-2.973-2.973-2.973-7.81 0-10.783l2.743-2.743a1.624 1.624 0 1 1 2.298 2.298l-2.743 2.743a4.38 4.38 0 0 0 0 6.187c.826.826 1.925 1.281 3.094 1.281s2.267-.455 3.094-1.281l6-6a4.38 4.38 0 0 0 0-6.187 1.624 1.624 0 1 1 2.298-2.298c2.973 2.973 2.973 7.81 0 10.783l-6 6A7.575 7.575 0 0 1 8 31.625z" /></svg>
</a>
 <a class="back-to-top" href="#top">back to top</a></h2>

<p>At 10up, we generally employ unit and integration tests only when building applications that are meant to be distributed. Writing tests for client themes usually does not offer a huge amount of value (there are of course exceptions to this). When writing tests, it’s important to use the framework that best fits the situation and make sure it is well documented for future engineers coming onto the project.</p>

<h2 id="libraries" class="anchor-heading">Libraries <a class="subhead-anchor" href="#libraries"><span>#libraries</span> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-link" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><path d="M13.757 19.868a1.62 1.62 0 0 1-1.149-.476c-2.973-2.973-2.973-7.81 0-10.783l6-6C20.048 1.169 21.963.376 24 .376s3.951.793 5.392 2.233c2.973 2.973 2.973 7.81 0 10.783l-2.743 2.743a1.624 1.624 0 1 1-2.298-2.298l2.743-2.743a4.38 4.38 0 0 0 0-6.187c-.826-.826-1.925-1.281-3.094-1.281s-2.267.455-3.094 1.281l-6 6a4.38 4.38 0 0 0 0 6.187 1.624 1.624 0 0 1-1.149 2.774z" /><path d="M8 31.625a7.575 7.575 0 0 1-5.392-2.233c-2.973-2.973-2.973-7.81 0-10.783l2.743-2.743a1.624 1.624 0 1 1 2.298 2.298l-2.743 2.743a4.38 4.38 0 0 0 0 6.187c.826.826 1.925 1.281 3.094 1.281s2.267-.455 3.094-1.281l6-6a4.38 4.38 0 0 0 0-6.187 1.624 1.624 0 1 1 2.298-2.298c2.973 2.973 2.973 7.81 0 10.783l-6 6A7.575 7.575 0 0 1 8 31.625z" /></svg>
</a>
 <a class="back-to-top" href="#top">back to top</a></h2>

<p>With the influx of JavaScript upgrades in recent years, the need for a third-party library to polyfill functionality is becoming more and more rare (outside of a build script). Don’t load in extensions unless the benefit outweighs the size of and added load-time of using it. While it is often more efficient for coding to use a quick jQuery method, it is rarely worth bringing in an entire library for one-off instances.</p>

<p>If you are working on a legacy project that already contains a library, make sure you’re still evaluating the need for it as you build out features to best set up clients for the future.</p>

<p>There are many JavaScript libraries available today. Many of them directly compete with each other. We try to stay consistent with what WordPress uses. The following is a list of primary libraries used by 10up.</p>

<h3 id="components">Components</h3>
<p><a href="https://10up.github.io/wp-component-library/">WP Component Library</a> - Provides us with a vetted, accessible, and standardized collection of UI component and Schema snippets we can use on projects.</p>

<h3 id="utility">Utility</h3>

<p><a href="http://underscorejs.org">Underscore</a> - Provides a number of useful utility functions such as <code class="language-plaintext highlighter-rouge">clone()</code>, <code class="language-plaintext highlighter-rouge">each()</code>, and <code class="language-plaintext highlighter-rouge">extend()</code>. WordPress core uses this library quite a bit.</p>

<h3 id="frameworks">Frameworks</h3>

<p><span id="react"><a href="https://reactjs.org/">React</a></span> - Using React provides a library to create large-scale, stateful JavaScript applications. It aims to provide a flexible system of creating highly componentized user interfaces. <a href="/react">Learn more about how we use React</a>.</p>

<p><a href="https://vuejs.org/">Vue</a> - Implementing Vue on a project allows us to take advantage of the statefulness built into something like React, but apply it on a much more lightweight and smaller scale as to not bog down performance by loading in a heavy library. <a href="/vue">Learn more about how we use Vue</a>.</p>

<p><a href="http://backbonejs.org">Backbone</a> - Provides a framework for building complex JavaScript applications. Backbone is based on the usage of models, views, and collections. WordPress core relies heavily on Backbone especially in the media library. Backbone requires Underscore and a DOM manipulation library.</p>

<h3 id="cookies">Cookies</h3>
<p>Safari browser’s Intelligent Tracking Prevention (ITP) 2.1 sets the expiration period at 7 days for all first-party cookies set by in-line (or tag management solution injected) vendor JavaScript libraries like Google Analytics’ analytics.js.</p>

<p>Authentication cookies (secure and HTTP-only) which have been properly implemented won’t be affected by the 7-day cap. These cookies should be deployed using the Set-Cookie header in the HTTP response and inaccessible via JavaScript’s document.cookie API.</p>

<p>Solutions for other types of cookies include:</p>

<ol>
  <li>Using localStorage to persist the unique identifier (i.e. the client ID) instead of relying solely on the _ga cookie</li>
  <li>Setting the _ga cookie with the HTTP response, rather than with JavaScript
Keep in mind that these solutions come with caveats: using localStorage only works on the same domain and would not work for cross-domain tracking.</li>
</ol>

<p>As an alternative to local storage, server-side tracking via the proxy layer in Cloudflare is probably the best option for clients with significant traffic from Safari.</p>


</div>


    <div class="footer-about">
	<div class="footer-about-inner">

		<div class="cta-careers">
			Already doing all this?<br>
			<a href="https://10up.com/careers" class="button party-blue">Careers at 10up</a>

		</div>

		<div class="license">
			<p>
				Open source, MIT licensed.<br>
				Copyright 2021
				<a href="https://twitter.com/10up">@10up</a> | <a href="https://10up.com/blog/2018/engineering-practices-accessibility-standards/">Accessibility Statement</a></p>
		</div>
	</div>
</div>
<footer role="contentinfo">
	<div class="page-footer-content">
		<a href="https://10up.com" class="logo-link">10up</a>
		<nav class="page-nav expanded" role="navigation" aria-label="footer-navigation">
			<ul>
				<li><a href="https://10up.com">10up.com</a></li>
			</ul>
			<div class="footer-social social-networks">
				<a href="https://twitter.com/10up" class="twitter"><span class="screen-reader-text">Twitter: @10up</span></a>
				<a href="https://github.com/10up" class="github"><span class="screen-reader-text">Github</span></a>
			</div>
		</nav>
	</div>
</footer>


    <script src="/js/main.js"></script>


  </body>
</html>
